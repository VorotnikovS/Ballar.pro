<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Ballar ‚Äî Rive Site</title>
  <script src="https://unpkg.com/@rive-app/webgl"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background-color: black;
    }

    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <canvas id="rive-canvas"></canvas>

  <script>
    const canvas = document.getElementById("rive-canvas");

    const dpr = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    canvas.style.width = "100vw";
    canvas.style.height = "100vh";

    let scrollYInput;
    let goToWWInput;
    let goToMathInput;
    let ButtonBackInput;
    let goAppStoreWWInput;
    let GoGooglePlayMathInput;
    let GoAppStoreMathInput;

    const riveInstance = new rive.Rive({
      src: "ballar.riv",
      canvas: canvas,
      autoplay: true,
      artboard: "Ballar",
      stateMachines: ["State Machine 1"],
      layout: new rive.Layout({
        fit: rive.Fit.FitWidth,
        alignment: rive.Alignment.TopCenter
      }),
      onLoad: () => {
        console.log("‚úÖ Rive animation loaded.");

        const inputs = riveInstance.stateMachineInputs("State Machine 1");

        // –ü–µ—Ä–µ–¥–∞—ë–º —à–∏—Ä–∏–Ω—É —ç–∫—Ä–∞–Ω–∞ –≤ input 'Size'
        const sizeInput = inputs.find(i => i.name === "Size");
        if (sizeInput) {
          sizeInput.value = window.innerWidth;
          console.log("üìè –ü–µ—Ä–µ–¥–∞–Ω–æ –≤ Rive Size:", sizeInput.value);
        } else {
          console.warn("‚ùóÔ∏è Input 'Size' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ State Machine 1");
        }

        // –ù–∞—Ö–æ–¥–∏–º ScrollY input
        scrollYInput = inputs.find(i => i.name === "ScrollY");
        if (!scrollYInput) {
          console.warn("‚ùóÔ∏è Input 'ScrollY' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ State Machine 1");
        }

        ButtonBackInput = inputs.find(i => i.name === "ButtonBack");

        goToMathInput = inputs.find(i => i.name === "goToMath");

        goAppStoreWWInput = inputs.find(i => i.name === "GoAppStoreWW"); 
        
        GoGooglePlayMathInput = inputs.find(i => i.name === "GoGooglePlayMath");

        GoAppStoreMathInput = inputs.find(i => i.name === "GoAppStoreMath");

        // –ù–∞—Ö–æ–¥–∏–º —Ñ–ª–∞–≥ GoToWW, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –∏–∑ Trigger
        goToWWInput = inputs.find(i => i.name === "GoToWW");
        if (!goToWWInput) {
          console.warn("‚ùóÔ∏è Input 'GoToWW' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ State Machine 1");
        }

        GoGooglePlayMathInput = inputs.find(i => i.name === "GoGooglePlayMath");
        if (!GoGooglePlayMathInput) {
          console.warn("‚ùóÔ∏è Input 'GoToWW' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ State Machine 1");
        }

        GoAppStoreMathInput = inputs.find(i => i.name === "GoAppStoreMath");
        if (!GoAppStoreMathInput) {
          console.warn("‚ùóÔ∏è Input 'GoToWW' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ State Machine 1");
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª–µ–∂–µ–Ω–∏–µ –∑–∞ GoToWW
        monitorTriggerFlag();
      },
      onError: (err) => console.error("‚ùå –û—à–∏–±–∫–∞ Rive:", err)
    });

    // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏
    window.addEventListener("wheel", (e) => {
      if (scrollYInput) {
        scrollYInput.value += e.deltaY * 0.3;

        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –æ—Ç 0 –¥–æ 2000
        scrollYInput.value = Math.max(0, Math.min(4000, scrollYInput.value));

        console.log("üñ± ScrollY =", scrollYInput.value);
      }
    });

    // –ü–ª–∞–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ScrollY –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ Trigger
    function monitorTriggerFlag() {
  if (goToWWInput && scrollYInput && goToWWInput.value === true) {
    console.log("üéØ –°—Ä–∞–±–æ—Ç–∞–ª Trigger GoToWW ‚Äî –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ 1500");
    goToWWInput.value = false;
    animateScrollYTo(1285);
  }

  if (goToMathInput && scrollYInput && goToMathInput.value === true) {
    console.log("üéØ –°—Ä–∞–±–æ—Ç–∞–ª Trigger goToMath ‚Äî –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ 1000");
    goToMathInput.value = false;
    animateScrollYTo(2474);
  }

  if (ButtonBackInput && scrollYInput && ButtonBackInput.value === true) {
    console.log("üéØ –°—Ä–∞–±–æ—Ç–∞–ª Trigger goToMath ‚Äî –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ 1000");
    ButtonBackInput.value = false;
    animateScrollYTo(0);
  }

  if (goAppStoreWWInput && goAppStoreWWInput.value === true) {
    console.log("üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º App Store WW");
    goAppStoreWWInput.value = false;
    window.open("https://apps.apple.com/ru/app/wake-the-world-my-map/id1529898421?l=en-GB", "_blank"); // ‚Üê –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ—é —Å—Å—ã–ª–∫—É
  }

  if (GoGooglePlayMathInput && GoGooglePlayMathInput.value === true) {
    console.log("üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º App Store WW");
    GoGooglePlayMathInput.value = false;
    window.open("", "_blank"); // ‚Üê –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ—é —Å—Å—ã–ª–∫—É
  }

  if (GoAppStoreMathInput && GoAppStoreMathInput.value === true) {
    console.log("üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º App Store WW");
    GoAppStoreMathInput.value = false;
    window.open("https://apps.apple.com/us/app/math-game-mental-mastery/id6745556295", "_blank"); // ‚Üê –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ—é —Å—Å—ã–ª–∫—É
  }

  requestAnimationFrame(monitorTriggerFlag);
}

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –∑–∞–¥–∞–Ω–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é ScrollY
    function animateScrollYTo(targetValue) {
      const duration = 600; // –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
      const startValue = scrollYInput.value;
      const startTime = performance.now();

      function step(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easedProgress = easeInOutQuad(progress);
        scrollYInput.value = startValue + (targetValue - startValue) * easedProgress;

        if (progress < 1) {
          requestAnimationFrame(step);
        } else {
          console.log("‚úÖ –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
        }
      }

      requestAnimationFrame(step);
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ (easing)
    function easeInOutQuad(t) {
      return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
    }
  </script>
</body>
</html>
